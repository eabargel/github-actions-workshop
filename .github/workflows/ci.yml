name: CI

on:
  pull_request:
    branches:
      - add-more-ci-commands

concurrency:
  group: ${{ github.ref }}
  cancel-in-progress: true

jobs:
    build-cache:
      runs-on: ubuntu-latest

      steps:
        - name: Cache yarn dependencies
          uses: actions/cache@v2
          id: yarn-cache
          with:
            path: |
              /home/runner/.cache/Cypress
              **/node_modules
            key: our-cache-yarn-${{ hashFiles('**/yarn.lock.json') }}

        - name: Install dependencies
          if: steps.yarn-cache.outputs.cache-hit != 'true'
          run: yarn install

    build-Lint:
      needs: build-cache
      runs-on: ubuntu-latest

      steps:
        - name: Checkout
          uses: actions/checkout@v2
          with:
            fetch-depth: 0

        - name: Setup NodeJS 16
          uses: actions/setup-node@v1
          with:
            node-version: 16
            cache: 'yarn'

        - name: Cache yarn dependencies
          uses: actions/cache@v2
          id: yarn-cache
          with:
            path: |
              /home/runner/.cache/Cypress
              **/node_modules
            key: our-cache-yarn-${{ hashFiles('**/yarn.lock.json') }}

        - name: Install dependencies
          if: steps.yarn-cache.outputs.cache-hit != 'true'
          run: yarn install

        - name: Lint
          run: yarn lint:ci

    test-unit:
      needs: build-cache
      runs-on: ubuntu-latest

      steps:
        - name: Checkout
          uses: actions/checkout@v2
          with:
            fetch-depth: 0

        - name: Setup NodeJS 16
          uses: actions/setup-node@v1
          with:
            node-version: 16
            cache: 'yarn'

        - name: Cache yarn dependencies
          uses: actions/cache@v2
          id: yarn-cache
          with:
            path: |
              /home/runner/.cache/Cypress
              **/node_modules
            key: our-cache-yarn-${{ hashFiles('**/yarn.lock.json') }}

        - name: Install dependencies
          if: steps.yarn-cache.outputs.cache-hit != 'true'
          run: yarn install

        - name: Test
          run: yarn test:ci

    test-e2e:
      needs: build-cache
      runs-on: ubuntu-latest

      steps:
        - name: Checkout
          uses: actions/checkout@v2
          with:
            fetch-depth: 0

        - name: Setup NodeJS 16
          uses: actions/setup-node@v1
          with:
            node-version: 16
            cache: 'yarn'

        - name: Cache yarn dependencies
          uses: actions/cache@v2
          id: yarn-cache
          with:
            path: |
              /home/runner/.cache/Cypress
              **/node_modules
            key: our-cache-yarn-${{ hashFiles('**/yarn.lock.json') }}

        - name: Install dependencies
          if: steps.yarn-cache.outputs.cache-hit != 'true'
          run: yarn install

        - name: e2e
          run: yarn e2e



